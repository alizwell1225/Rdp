# gRPC 長時間壓力測試功能指南

## 概述

為了支援兩台電腦之間的 gRPC Server/Client 長時間資料傳輸測試，我們新增了完整的壓力測試功能。

## Client 端壓力測試功能

### 功能特點

1. **多種測試類型**
   - JSON 傳送：連續發送指定大小的 JSON 資料
   - 檔案上傳：連續上傳隨機生成的測試檔案
   - 檔案下載：連續從伺服器下載檔案
   - 混合測試：隨機執行上述三種操作

2. **可配置參數**
   - **測試類型**：選擇要執行的測試類型
   - **間隔時間 (ms)**：每次操作之間的等待時間（最小 100ms）
   - **資料大小 (KB)**：每次傳輸的資料大小（最小 1KB）
   - **執行次數**：測試總共執行的次數
   - **無限執行**：勾選後會持續執行直到手動停止

3. **即時統計資訊**
   - 執行次數：已完成的測試次數
   - 成功次數：成功完成的操作數
   - 失敗次數：失敗的操作數
   - 成功率：成功操作的百分比
   - 平均時間：每次操作的平均耗時
   - 總時間：測試已執行的總時間

### 使用方法

1. **啟動 Client 應用程式**
   ```
   連線到 gRPC Server
   ```

2. **配置壓力測試參數**
   - 選擇測試類型（JSON/上傳/下載/混合）
   - 設定間隔時間（建議：1000ms）
   - 設定資料大小（建議：10KB）
   - 設定執行次數或勾選無限執行

3. **開始測試**
   - 點擊「開始壓測」按鈕
   - 觀察即時統計資訊
   - 查看日誌中的詳細執行記錄

4. **停止測試**
   - 點擊「停止壓測」按鈕（按鈕會變紅色）
   - 測試結束後會顯示最終統計結果

### 範例配置

#### 輕量級長時間測試
```
測試類型：JSON 傳送
間隔：2000ms（每 2 秒一次）
大小：5KB
次數：無限執行
```

#### 中等負載測試
```
測試類型：混合測試
間隔：1000ms（每秒一次）
大小：50KB
次數：10000 次
```

#### 高負載壓力測試
```
測試類型：檔案上傳
間隔：500ms（每秒兩次）
大小：1000KB（1MB）
次數：無限執行
```

## Server 端監控功能

### 功能特點

1. **即時統計資訊**
   - 運行時間：伺服器啟動後的運行時間
   - 總請求數：接收到的總請求數量
   - 請求速率：每秒接收的平均請求數
   - 總流量：接收的總資料量（MB）
   - 流量速率：每秒接收的平均資料量（MB/秒）
   - 連線數：當前連接的客戶端數量

2. **統計資料重置**
   - 可隨時重置統計資料
   - 重置後從 0 開始重新計算

### 使用方法

1. **啟動 Server 應用程式**
   ```
   配置 Host 和 Port
   點擊「Apply & Start」啟動伺服器
   ```

2. **監控統計資訊**
   - 統計資訊每秒自動更新
   - 觀察請求處理速率和流量
   - 檢查是否有異常的請求失敗

3. **重置統計**
   - 點擊「重置統計」按鈕
   - 統計計數器歸零，重新開始計算

## 長時間測試建議

### 測試場景 1：穩定性測試（24 小時）

**Client 配置：**
```
測試類型：混合測試
間隔：5000ms（每 5 秒）
大小：20KB
次數：無限執行
```

**目的：**驗證系統能否長時間穩定運行，檢測記憶體洩漏、連線穩定性等問題。

### 測試場景 2：高頻率測試（1 小時）

**Client 配置：**
```
測試類型：JSON 傳送
間隔：100ms（每秒 10 次）
大小：10KB
次數：36000（1 小時）
```

**目的：**測試高頻率請求下的系統表現。

### 測試場景 3：大檔案傳輸測試

**Client 配置：**
```
測試類型：檔案上傳
間隔：10000ms（每 10 秒）
大小：10240KB（10MB）
次數：360（1 小時）
```

**目的：**測試大檔案傳輸的穩定性和效能。

## 兩台電腦測試步驟

### 電腦 A（Server 端）

1. 開啟 GrpcServerApp
2. 設定 Host 為 `0.0.0.0`（監聽所有網路介面）
3. 設定 Port（例如：50051）
4. 點擊「Apply & Start」
5. 記下電腦 A 的 IP 位址（例如：192.168.1.100）
6. 觀察「伺服器統計資訊」面板

### 電腦 B（Client 端）

1. 開啟 GrpcClientApp
2. 設定 Host 為電腦 A 的 IP（例如：192.168.1.100）
3. 設定 Port（例如：50051）
4. 點擊「Apply & Connect」
5. 配置壓力測試參數
6. 點擊「開始壓測」
7. 觀察即時統計資訊

### 監控重點

#### Client 端觀察項目：
- 成功率應該保持在 99% 以上
- 平均時間應該穩定，不應持續增長
- 失敗次數應該極少

#### Server 端觀察項目：
- 請求速率應該穩定
- CPU 和記憶體使用率應該穩定
- 沒有錯誤訊息或異常

### 異常處理

#### 連線中斷
- Client 會記錄失敗次數
- 檢查網路連線
- 重新啟動測試

#### 效能下降
- 觀察 Server 端資源使用
- 調整測試參數（降低頻率或大小）
- 檢查磁碟空間

#### 記憶體洩漏
- 長時間測試後記憶體持續增長
- 停止測試，重新啟動應用程式
- 回報問題供修復

## 測試結果記錄

建議記錄以下資訊：

```
測試日期：2024-XX-XX
測試時長：XX 小時
測試類型：混合測試
間隔時間：1000ms
資料大小：10KB

Client 端結果：
- 總執行次數：XXXXX
- 成功次數：XXXXX
- 失敗次數：XX
- 成功率：99.XX%
- 平均時間：XXXms

Server 端結果：
- 總請求數：XXXXX
- 總流量：XXX MB
- 平均速率：XX 請求/秒
- 異常情況：無/有（詳細說明）
```

## 注意事項

1. **防火牆設定**
   - 確保防火牆允許 gRPC 通訊埠（預設 50051）

2. **磁碟空間**
   - 檔案上傳測試會占用伺服器磁碟空間
   - 定期清理測試檔案

3. **網路頻寬**
   - 注意測試參數不要超過網路頻寬限制
   - 避免影響其他網路服務

4. **資源監控**
   - 使用系統監控工具觀察 CPU、記憶體、網路使用率
   - Windows：工作管理員
   - Linux：htop、iftop

5. **日誌管理**
   - 長時間測試會產生大量日誌
   - 可定期清理日誌視窗

## 故障排除

### 問題：連線失敗

**可能原因：**
- 網路不通
- 防火牆阻擋
- Server 未啟動
- IP/Port 設定錯誤

**解決方法：**
- 使用 ping 測試網路連通性
- 檢查防火牆設定
- 確認 Server 已啟動
- 檢查 IP 和 Port 設定

### 問題：成功率低

**可能原因：**
- 網路不穩定
- Server 過載
- 參數設定過於激進

**解決方法：**
- 檢查網路品質
- 降低測試頻率或大小
- 檢查 Server 資源使用情況

### 問題：應用程式當機

**可能原因：**
- 記憶體洩漏
- 未處理的例外
- 資源耗盡

**解決方法：**
- 重新啟動應用程式
- 降低測試參數
- 回報問題日誌

## 總結

這套壓力測試功能提供了完整的長時間資料傳輸測試能力，可以：

✅ 驗證系統穩定性  
✅ 評估效能表現  
✅ 發現潛在問題  
✅ 監控即時狀態  
✅ 記錄詳細統計  

適合用於開發、測試和生產環境的品質保證工作。
